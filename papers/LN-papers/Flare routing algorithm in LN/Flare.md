<!--
 * @Author: ZhXZhao
 * @Date: 2020-09-12 16:05:49
 * @LastEditors: ZhXZhao
 * @LastEditTime: 2020-09-12 18:00:23
 * @Description:
-->
# Flare: An Approach to Routing in Lightning Network

---


## 早期的想法

### Hub-and-spoke Network

将闪电网络中的节点分为两类：1）钱包节点。2）路由节点。
钱包节点只能发起支付，路由节点只能路由支付。
钱包节点知晓所有路由节点的情况，所以能够很容易找到路由路径。但**缺点**也很明显，这个方案很容易导致中心化（大的路由节点产生），而且没有机制来奖励钱包节点保持在线，这会导致一笔支付会滞留在最接近接收者的路由节点上。纯路由节点还会面临容错的问题，若路由节点突然下线，会导致网络瘫痪，无法路由交易。

### Global Beacons

**周期性**地随机选择一些节点作为Global Beacons，所有节点发送支付都要寻找经过Global Beacons的路径，这比前一个方案更加去中心化。但**缺点**有：
1. 由于Global Beacons节点比普通节点的收益更高，所以会导致女巫攻击，以增大成为Global Beacons节点的几率。
2. Global Beacons节点易受到Dos攻击。
3. 节点需要在带宽，计算能力和财力上都有很高的水平才能成为Global Beacons节点，这使得Global Beacons节点的候选者很少。
4. Global Beacons节点在被选择期间需要创建很多支付通道，而在选择期间过后，大多数通道都被废弃了。

### Local Beacons

每个节点选择一个自己的Beacons节点列表，在发送支付时，发送者和接收者比较他们的Beacons节点列表，若有交集则可路由。这样做可以使得网络中的流量分布更均匀，交易费的分布也更加平均，这也会刺激节点始终保持在线，提升网络的路由能力和流动能力。

## 其他路由算法

闪电网络可以类比为移动ad hoc网络(mobile ad hoc network(MANET))。因此闪电网络的路由算法可以从MANETs的路由算法中借鉴。
MANETs的路由算法可以分为3类：
1. 表驱动（主动）协议：协议以路由表的形式维护一个最新的关于全网节点的路由信息，但这种主动路由协议有很大的控制开销，不能扩展到大型网络中。
2. 按需（被动）协议：只有在路径被需要的时候，协议才会执行路径发现过程并交换路由信息。
3. 混合协议：是主动协议和被动协议之间的一个权衡。主动协议提供了很好的时延和可靠性，但不适用于大型网络；被动协议为了扩展性和牺牲了可靠性。例如，节点维护一个局部网络的路由表和一些到从地址空间较近的节点的路由，在路由阶段，从中间节点中请求那些缺失的路由路径。


## 本文提出的路由算法

Flare分为两个阶段：主动阶段和被动阶段。
闪电网络的状态信息可以分为两类：
1. 变化缓慢的静态信息：支付通道
2. 变化迅速的动态信息：节点状态，支付通道中的资金分布，交易费等

Flare会主动收集这些静态信息。

![Flare描述图](pic/../Flare%20description.png)
