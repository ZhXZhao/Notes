<!--
 * @Author: ZhXZhao
 * @Date: 2021-03-17 17:12:00
 * @LastEditors: ZhXZhao
 * @LastEditTime: 2021-03-18 20:51:41
 * @Description:
-->

# 数据链路层

数据链路层使用的信道：**点对点信道**和**广播信道**。

**链路**：指连接两个相邻节点的物理线路。（物理层）
**数据链路**：在链路上加上了实现必要的通信协议的硬件和软件。

点对点信道的数据链路层通信主要步骤：
1. 节点A的数据链路层把网络层交下来的IP数据报添加首部和尾部封装成帧。
2. 节点A把封装好的帧发送给节点B的数据链路层。
3. 若节点B的数据链路层收到的帧无差错，则从收到的帧中提取出IP数据报，上交给上面的网络层，否则丢弃这个帧。

## 三个基本问题
封装成帧、透明传输、差错检测。

### 封装成帧
接收端可以根据首和尾的标记，从物理层收到的比特流中识别帧的开始和结束。

### 透明传输
传送的帧是用文本文件组成的帧时（文本文件中的字符都是从键盘上输入的），数据部分不会出现特殊的帧定界控制字符，这样的传输就是透明传输。
当数据部分是非ASCII码的文件时，数据部分的某个字节的二进制代码可能会出现与帧定界控制字符相同的情况，这样就会错误地找到帧边界。
为解决上述的情况，希望实现透明传输，对于数据中出现的控制字符，在其前插入转义字符“ESC”（十六进制为1B）。接收端在把数据交给网络层之前删除转义字符。转义字符出现在数据当中时，同样在转义字符前插入转义字符。该方法可以称为**字节填充法**。

### 差错检测
“0”变成“1”，“1”变成“0”称为**比特差错**。为解决这种差错，出现了**循环冗余检验CRC**检错技术。
除比特差错外，还有**帧丢失**、**帧重复**或**帧失序**。

**同步传输**：一连串的比特连续传送。
**异步传输**：逐个字符地传送。

### 广播信道
广播信道时，所有节点都在同一个广播信道上发送数据，因此需要有专门的控制方法进行协调，避免发生冲突（碰撞）。
两种方法：**信道复用**、**CSMA/CD协议**。

#### 信道复用
1. **频分复用**。所有主机在相同时间占用不同的频率带宽资源。
2. **时分复用**。所有主机在不同的时间占用相同的频率带宽资源。
3. **统计时分复用**。由于前两种方法在通信过程中，主机会一直占用部分信道资源，通道利用率低。所以有了改进，不固定用户在时分复用帧中的未知，只要有数据就集中起来组成统计时分复用帧然后发送。
4. **波分复用**。光的频分复用。
5. **码分复用**。为所有用户分配m bit的码片，所有码片都正交。在接收端使用码片对接收到的数据做内积，结果为0的是其他用户发送的数据，结果为1的是用户发送的比特1，结果为-1的是用户发送的比特0。但是需要发送的数据量为原来的m倍。

#### CSMA/CD 协议
CSMA/CD表示载波监听多点接入/碰撞检测。

+ **多点接入**：总线型网络，许多主机以多点的方式连接到总线上。
+ **载波监听**：每个主机都必须不停地监听信道。在发送前，如果监听到信道正在使用，就必须等待。
+ **碰撞检测**：在发送中，如果监听到信道已有其他主机正在发送数据，就表示发生了碰撞。虽然有**载波监听**，但是由于电磁波的传播时延，还是有可能发生碰撞。

记端到端的传输时延为$\tau$，最先发送的站点最多经过2$\tau$就可以直到是否发生了碰撞，称2$\tau$为争用期。过了争用期还未检测到碰撞，才可以肯定这次发送不会发生碰撞。

当碰撞发生时，站点要停止发送，等待一段时间再发送，从一个离散的整数集合中随机取出一个数，记作$r$，然后取r倍的争用期作为重传等待时间。

#### PPP协议
PPP协议是用户计算机和ISP（互联网服务提供商）进行通信时所使用的数据链路层协议。
PPP帧格式：

| F(帧的定界符) | A   | C   | 协议 | IP数据报 | FCS(CRC的检验序列) | F(帧的定界符) |
| ------------- | --- | --- | ---- | -------- | ------------------ | ------------- |

### MAC地址
链路层地址，长度48位，用于唯一表示网络适配器（网卡）。

一台主机拥有多少个网络适配器就有多少个MAC地址。

### 局域网

### 交换机

