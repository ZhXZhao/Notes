<!--
 * @Author: ZhXZhao
 * @Date: 2020-02-20 22:05:21
 * @LastEditors: ZhXZhao
 * @LastEditTime: 2020-02-20 22:51:45
 * @Description: 
 -->

# 交易的输入和输出


---

- [交易的输入和输出](#%e4%ba%a4%e6%98%93%e7%9a%84%e8%be%93%e5%85%a5%e5%92%8c%e8%be%93%e5%87%ba)
  - [交易输出](#%e4%ba%a4%e6%98%93%e8%be%93%e5%87%ba)
    - [支付条件（障碍）](#%e6%94%af%e4%bb%98%e6%9d%a1%e4%bb%b6%e9%9a%9c%e7%a2%8d)
  - [交易输入](#%e4%ba%a4%e6%98%93%e8%be%93%e5%85%a5)
  - [交易费](#%e4%ba%a4%e6%98%93%e8%b4%b9)
  - [把交易费加到交易中](#%e6%8a%8a%e4%ba%a4%e6%98%93%e8%b4%b9%e5%8a%a0%e5%88%b0%e4%ba%a4%e6%98%93%e4%b8%ad)

比特币交易的基本单位是未经使用的一个交易输出，简称**UTXO**。**UTXO**是不能再分割、被所有者锁住或记录于区块链中的并被整个网络识别成货币单位的一定量的比特币货币。

比特币钱包通过扫描区块链并聚合所有属于该用户的UTXO来计算该用户的余额。一个用户的比特币会被当作UTXO分散到数百个交易和数百个区块中。

一个UTXO可以是一“聪”的任意倍，且是不可再分的。被交易消耗的UTXO被称为**交易输入**，由交易创建的UTXO被称为**交易输出**。一笔比特币交易通过使用**所有者的签名来解锁UTXO**，并通过使用**新的所有者的比特币地址来锁定并创建UTXO**。

有一种特殊的交易叫做币基交易（Coinbase），是每个区块中的首个交易，用于奖励挖出该区块的比特币矿工，币基交易**没有输入，只有输出**。

## 交易输出

给某人发送比特币实际上是创造新的UTXO，注册到那个人的地址，并且能被他用于新的支付。

交易输出包含两部分：
1. 一定量的比特币。
2. 一个锁定脚本。

交易输出的结构

| 大小                  | 字段           | 描述                                  |
| --------------------- | -------------- | ------------------------------------- |
| 8个字节               | 比特币数量     | 用聪（$10^{-8}$比特币）表示的比特币值 |
| 1-9个字节（可变整数） | 锁定脚本的大小 | 用字节表示的后面的锁定脚本长度        |
| 变长                  | 锁定脚本       | 一个定义了支付输出所需条件的脚本      |

### 支付条件（障碍）

**锁定脚本**：支付输出所必须满足的条件或者障碍。
一个交易的输出在目的地址上形成障碍，或者说被锁在了目的地址上，这样这部分输出会被记录在区块链上，成为UTXO的一部分，当目的地址的主人要使用这笔款项时，需要先消除障碍，这可通过目的地址主人的私钥来解锁。

## 交易输入

交易输入是指向UTXO的指针。若想支付UTXO，一个交易的输入也需要包含一个**解锁脚本**，用来满足UTXO的支付条件。解锁脚本通常是一个**签名**，用来证明拥有对于在锁定脚本中的比特币地址的所有权。

交易输入的结构

| 大小                  | 字段         | 描述                                       |
| --------------------- | ------------ | ------------------------------------------ |
| 32个字节              | 交易         | 指向交易包含的被花费的UTXO的哈希指针       |
| 4个字节               | 输出索引     | 被花费的UTXO的索引号，第一个为0            |
| 1-9个字节（可变整数） | 解锁脚本大小 | 用字节表示的后面的解锁脚本长度             |
| 变长                  | 解锁脚本     | 一个达到UTXO锁定脚本中的条件的脚本         |
| 4个字节               | 序列号       | 目前未被使用的交易替换功能，设成0xFFFFFFFF |

## 交易费

交易费可当作是为了包含（挖矿）一笔交易到下一个区块中的一种鼓励，也可当作是对于欺诈交易和任何种类的系统滥用，交易费被挖出这个区块的矿工所获得。

## 把交易费加到交易中

交易的数据结构没有交易费的字段。交易费通过所有输入的总和，以及所有输出的总和之间的差来表示。交易费与交易的大小有关，如单位交易费乘以交易的字节大小，与参加交易的比特币币值无关。
