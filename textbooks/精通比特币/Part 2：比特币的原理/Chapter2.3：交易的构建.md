<!--
 * @Author: ZhXZhao
 * @Date: 2020-02-17 23:06:11
 * @LastEditors: ZhXZhao
 * @LastEditTime: 2020-02-17 23:06:11
 * @Description: 
 -->

# 交易的构建

---



钱包应用可以自动选取合适的输入和输出以建立交易，用户只需要指定目标地址和金额即可。

值得注意的一点是，钱包应用在离线时也可以建立交易。比特币交易建立和签名时不用连接比特币网络。只有在执行交易时才需要将交易发送到网络。

## 获取正确的输入

大多数钱包应用都维护着一个用钱包自己的密钥锁定的“未消费交易输出”小型数据库。钱包应用会从这个“未消费交易输出”小型数据库中检索出足够支付的“未消费交易输出”来完成交易。

如果钱包客户端没有某一未消费交易输出，它可以通过不同的服务者提供的各种API或完整索引节点的JSON PRC API从比特币网络中拿到这一交易信息。
例如用HTTP GET命令对一个特定URL建立了一个RESTful API的请求。这个URL会返回一个地址的所有未消费交易输出，以提供给需要这些信息的任何应用作为建立新交易的输入而进行消费。
> $ curl https://blockchain.info/unspent?active=1Cdid9KFAaatwczBwBttQcwXYCpvK8h7FK

## 创建交易输出

交易输出会包含一个脚本，这个脚本说 “这个输出谁能拿出一个签名和Bob的公开地址匹配上，就支付给谁”。

## 将交易放到总账簿中

交易需要被传输到比特币网络中，以成为分布式账簿（区块链）的一部分。

### 交易的传输

比特币网络是由参与的比特币客户端连接其他比特币客户端组成的P2P网络。比特币网络的目的是将交易和区块传播给所有参与者。

### 如何传播

钱包应用可以发送新的交易给其他任意一个已连接到互联网的比特币客户端。任何比特币网络节点（比特币客户端）收到一个之前没见过的有效交易时，会立刻将它转发给连接到自身的其他节点。
