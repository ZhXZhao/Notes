<!--
 * @Author: ZhXZhao
 * @Date: 2020-02-10 19:38:46
 * @LastEditors  : ZhXZhao
 * @LastEditTime : 2020-02-10 20:32:38
 * @Description: 
 -->
# 矿工的任务

---

- [矿工的任务](#%e7%9f%bf%e5%b7%a5%e7%9a%84%e4%bb%bb%e5%8a%a1)
  - [寻找有效区块](#%e5%af%bb%e6%89%be%e6%9c%89%e6%95%88%e5%8c%ba%e5%9d%97)
  - [决定难度](#%e5%86%b3%e5%ae%9a%e9%9a%be%e5%ba%a6)

成为比特币矿工的步骤：
1. 加入比特币网络并与其他节点相联。
2. 监听交易广播。验证交易的签名是正当有效的，交易输出没有被重复支付。
3. 维护区块链网络和监听新的区块。验证收到的每个区块，保证区块里的每笔交易都是有效的，而且这个区块包含一个有效的随机数。
4. 组装一个备选区块。当拥有了最新的全部区块链数据备份后，即可制造自己的区块。
5. 找到一个让你的区块有效的随机数。
6. 希望你的区块被全网接受。
7. 获得利润。如果有矿工接受了你的区块，那你就会获得利润。

矿工的任务大体分为两类：1）验证交易和区块。2）和其他矿工竞争，找到区块。

## 寻找有效区块

寻找有效区块就是寻找一个使区块有效的随机数。
作为矿工，首先需要从你的交易池中选出一系列有效的交易并编译成梅克尔树。然后组装出一个新的区块，让它的头部指向区块链上的前一个区块。新区块的头部有一个32位的随机数，你需要不断尝试不同的随机数，使得整个区块的哈希值都小于目标值。
大多数情况，随机数试过所有32位可能的取值后，仍不能产生一个有效的哈希值，这时需要改变币基交易里的随机数（改变币基交易的随机数会导致整个梅克尔树的哈希值都改变，代价较大），再重新遍历区块头部的随机数来寻找有效哈希值。

## 决定难度

每挖出2016个区块，挖矿难度会改变一次，周期大约为两个星期。难度改变的公式
$$ 下一个难度=\frac{上一个难度\times 2016\times 10分钟}{产生上2016个区块所花费的时间} $$

